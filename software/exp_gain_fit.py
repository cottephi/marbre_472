import toolbox
import matplotlib.pyplot as plt
import numpy as np

def gain_func(p, x, dx):
  return p[0]*np.exp(p[1]*np.exp(-p[2]/(x/((0.001+dx/1000000))))*(0.001+dx/1000000))

Voltage = np.array([   10,   20,   30,   40,   50,   60,   70,   80,   90,  100,
        110,  120,  130,  140,  150,  160,  170,  180,  190,  200,  210,
        220,  230,  240,  250,  260,  270,  280,  290,  300,  310,  320,
        330,  340,  350,  360,  370,  380,  390,  400,  410,  420,  430,
        440,  450,  460,  470,  480,  490,  500,  510,  520,  530,  540,
        550,  560,  570,  580,  590,  600,  610,  620,  630,  640,  650,
        660,  670,  680,  690,  700,  710,  720,  730,  740,  750,  760,
        770,  780,  790,  800,  810,  820,  830,  840,  850,  860,  870,
        880,  890,  900,  910,  920,  930,  940,  950,  960,  970,  980,
        990, 1000, 1010, 1020, 1030, 1040, 1050, 1060, 1070, 1080, 1090,
       1100, 1110, 1120, 1130, 1140, 1150, 1160, 1170, 1180, 1190, 1200,
       1210, 1220, 1230, 1240, 1250, 1260, 1270, 1280, 1290, 1300, 1310,
       1320, 1330, 1340, 1350, 1360, 1370, 1380, 1390, 1400, 1410, 1420,
       1430, 1440, 1450, 1460, 1470, 1480, 1490, 1500, 1510, 1520, 1530,
       1540, 1550, 1560, 1570, 1580, 1590, 1600, 1610, 1620, 1630, 1640,
       1650, 1660, 1670, 1680, 1690, 1700, 1710, 1720, 1730, 1740, 1750,
       1760, 1770, 1780, 1790, 1800, 1810, 1820, 1830, 1840, 1850, 1860,
       1870, 1880, 1890, 1900, 1910, 1920, 1930, 1940, 1950, 1960, 1970,
       1980, 1990, 2000, 2010, 2020, 2030, 2040, 2050, 2060, 2070, 2080,
       2090, 2100, 2110, 2120, 2130, 2140, 2150, 2160, 2170, 2180, 2190,
       2200, 2210, 2220, 2230, 2240, 2250, 2260, 2270, 2280, 2290, 2300,
       2310, 2320, 2330, 2340, 2350, 2360, 2370, 2380, 2390, 2400, 2410,
       2420, 2430, 2440, 2450, 2460, 2470, 2480, 2490, 2500, 2510, 2520,
       2530, 2540, 2550, 2560, 2570, 2580, 2590, 2600, 2610, 2620, 2630,
       2640, 2650, 2660, 2670, 2680, 2690, 2700, 2710, 2720, 2730, 2740,
       2750, 2760, 2770, 2780, 2790, 2800, 2810, 2820, 2830, 2840, 2850,
       2860, 2870, 2880, 2890, 2900, 2910, 2920, 2930, 2940, 2950, 2960,
       2970, 2980, 2990, 3000, 3010, 3020, 3030, 3040, 3050, 3060, 3070,
       3080, 3090, 3100, 3110, 3120, 3130, 3140, 3150, 3160, 3170, 3180,
       3190, 3200, 3210, 3220, 3230, 3240, 3250, 3260, 3270, 3280, 3290,
       3300, 3310, 3320, 3330, 3340, 3350, 3360, 3370, 3380, 3390, 3400,
       3410, 3420, 3430, 3440, 3450, 3460, 3470, 3480, 3490, 3500, 3510,
       3520, 3530, 3540, 3550, 3560, 3570, 3580, 3590, 3600, 3610, 3620,
       3630, 3640, 3650, 3660, 3670, 3680, 3690, 3700, 3710, 3720, 3730,
       3740, 3750, 3760, 3770, 3780, 3790, 3800, 3810, 3820, 3830, 3840,
       3850, 3860, 3870, 3880, 3890, 3900, 3910, 3920, 3930, 3940, 3950,
       3960, 3970, 3980, 3990])
gain = np.array([   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137534e-01,   2.04137534e-01,   2.04137534e-01,
         2.04137535e-01,   2.04137535e-01,   2.04137535e-01,
         2.04137535e-01,   2.04137536e-01,   2.04137537e-01,
         2.04137538e-01,   2.04137540e-01,   2.04137542e-01,
         2.04137546e-01,   2.04137550e-01,   2.04137556e-01,
         2.04137565e-01,   2.04137576e-01,   2.04137590e-01,
         2.04137609e-01,   2.04137633e-01,   2.04137664e-01,
         2.04137704e-01,   2.04137754e-01,   2.04137818e-01,
         2.04137897e-01,   2.04137996e-01,   2.04138118e-01,
         2.04138268e-01,   2.04138451e-01,   2.04138674e-01,
         2.04138944e-01,   2.04139269e-01,   2.04139659e-01,
         2.04140124e-01,   2.04140677e-01,   2.04141332e-01,
         2.04142103e-01,   2.04143010e-01,   2.04144070e-01,
         2.04145305e-01,   2.04146741e-01,   2.04148402e-01,
         2.04150320e-01,   2.04152525e-01,   2.04155054e-01,
         2.04157945e-01,   2.04161240e-01,   2.04164986e-01,
         2.04169233e-01,   2.04174034e-01,   2.04179449e-01,
         2.04185541e-01,   2.04192378e-01,   2.04200033e-01,
         2.04208585e-01,   2.04218117e-01,   2.04228719e-01,
         2.04240487e-01,   2.04253522e-01,   2.04267933e-01,
         2.04283833e-01,   2.04301346e-01,   2.04320599e-01,
         2.04341727e-01,   2.04364873e-01,   2.04390189e-01,
         2.04417832e-01,   2.04447969e-01,   2.04480773e-01,
         2.04516427e-01,   2.04555123e-01,   2.04597059e-01,
         2.04642445e-01,   2.04691496e-01,   2.04744440e-01,
         2.04801512e-01,   2.04862956e-01,   2.04929026e-01,
         2.04999987e-01,   2.05076111e-01,   2.05157682e-01,
         2.05244993e-01,   2.05338347e-01,   2.05438057e-01,
         2.05544447e-01,   2.05657851e-01,   2.05778613e-01,
         2.05907088e-01,   2.06043642e-01,   2.06188651e-01,
         2.06342504e-01,   2.06505597e-01,   2.06678342e-01,
         2.06861159e-01,   2.07054481e-01,   2.07258752e-01,
         2.07474427e-01,   2.07701975e-01,   2.07941876e-01,
         2.08194620e-01,   2.08460714e-01,   2.08740674e-01,
         2.09035031e-01,   2.09344327e-01,   2.09669118e-01,
         2.10009976e-01,   2.10367485e-01,   2.10742241e-01,
         2.11134858e-01,   2.11545964e-01,   2.11976201e-01,
         2.12426227e-01,   2.12896717e-01,   2.13388362e-01,
         2.13901868e-01,   2.14437962e-01,   2.14997385e-01,
         2.15580899e-01,   2.16189284e-01,   2.16823340e-01,
         2.17483887e-01,   2.18171766e-01,   2.18887840e-01,
         2.19632994e-01,   2.20408136e-01,   2.21214199e-01,
         2.22052140e-01,   2.22922942e-01,   2.23827615e-01,
         2.24767199e-01,   2.25742758e-01,   2.26755392e-01,
         2.27806228e-01,   2.28896427e-01,   2.30027185e-01,
         2.31199731e-01,   2.32415333e-01,   2.33675297e-01,
         2.34980966e-01,   2.36333730e-01,   2.37735016e-01,
         2.39186301e-01,   2.40689107e-01,   2.42245006e-01,
         2.43855620e-01,   2.45522625e-01,   2.47247753e-01,
         2.49032794e-01,   2.50879599e-01,   2.52790083e-01,
         2.54766225e-01,   2.56810075e-01,   2.58923755e-01,
         2.61109462e-01,   2.63369472e-01,   2.65706143e-01,
         2.68121920e-01,   2.70619338e-01,   2.73201023e-01,
         2.75869703e-01,   2.78628208e-01,   2.81479473e-01,
         2.84426548e-01,   2.87472599e-01,   2.90620915e-01,
         2.93874915e-01,   2.97238152e-01,   3.00714317e-01,
         3.04307253e-01,   3.08020954e-01,   3.11859577e-01,
         3.15827447e-01,   3.19929068e-01,   3.24169128e-01,
         3.28552509e-01,   3.33084299e-01,   3.37769797e-01,
         3.42614527e-01,   3.47624248e-01,   3.52804963e-01,
         3.58162936e-01,   3.63704697e-01,   3.69437065e-01,
         3.75367153e-01,   3.81502388e-01,   3.87850523e-01,
         3.94419659e-01,   4.01218255e-01,   4.08255152e-01,
         4.15539588e-01,   4.23081220e-01,   4.30890146e-01,
         4.38976928e-01,   4.47352612e-01,   4.56028756e-01,
         4.65017456e-01,   4.74331374e-01,   4.83983767e-01,
         4.93988517e-01,   5.04360168e-01,   5.15113954e-01,
         5.26265842e-01,   5.37832568e-01,   5.49831678e-01,
         5.62281573e-01,   5.75201551e-01,   5.88611861e-01,
         6.02533752e-01,   6.16989526e-01,   6.32002597e-01,
         6.47597553e-01,   6.63800221e-01,   6.80637732e-01,
         6.98138598e-01,   7.16332788e-01,   7.35251806e-01,
         7.54928785e-01,   7.75398571e-01,   7.96697827e-01,
         8.18865132e-01,   8.41941095e-01,   8.65968466e-01,
         8.90992266e-01,   9.17059917e-01,   9.44221377e-01,
         9.72529297e-01,   1.00203917e+00,   1.03280951e+00,
         1.06490201e+00,   1.09838177e+00,   1.13331746e+00,
         1.16978153e+00,   1.20785051e+00,   1.24760515e+00,
         1.28913077e+00,   1.33251748e+00,   1.37786049e+00,
         1.42526044e+00,   1.47482372e+00,   1.52666282e+00,
         1.58089671e+00,   1.63765127e+00,   1.69705970e+00,
         1.75926298e+00,   1.82441038e+00,   1.89265997e+00,
         1.96417918e+00,   2.03914541e+00,   2.11774666e+00,
         2.20018223e+00,   2.28666344e+00,   2.37741440e+00,
         2.47267286e+00,   2.57269112e+00,   2.67773694e+00,
         2.78809461e+00,   2.90406602e+00,   3.02597181e+00,
         3.15415270e+00,   3.28897074e+00,   3.43081080e+00,
         3.58008212e+00,   3.73721992e+00,   3.90268723e+00,
         4.07697671e+00,   4.26061278e+00,   4.45415370e+00,
         4.65819400e+00,   4.87336696e+00,   5.10034730e+00,
         5.33985408e+00,   5.59265383e+00,   5.85956386e+00,
         6.14145590e+00,   6.43925988e+00,   6.75396817e+00,
         7.08663997e+00,   7.43840611e+00,   7.81047424e+00,
         8.20413435e+00,   8.62076475e+00,   9.06183849e+00,
         9.52893028e+00,   1.00237239e+01,   1.05480203e+01,
         1.11037463e+01,   1.16929634e+01,   1.23178788e+01,
         1.29808551e+01,   1.36844229e+01,   1.44312927e+01,
         1.52243689e+01,   1.60667642e+01,   1.69618157e+01,
         1.79131015e+01,   1.89244595e+01,   2.00000073e+01,
         2.11441635e+01,   2.23616709e+01,   2.36576217e+01,
         2.50374849e+01,   2.65071351e+01,   2.80728844e+01,
         2.97415170e+01,   3.15203261e+01,   3.34171539e+01,
         3.54404354e+01,   3.75992453e+01,   3.99033489e+01,
         4.23632577e+01,   4.49902886e+01,   4.77966292e+01,
         5.07954081e+01,   5.40007705e+01,   5.74279614e+01,
         6.10934148e+01,   6.50148511e+01,   6.92113821e+01,
         7.37036260e+01,   7.85138310e+01,   8.36660105e+01,
         8.91860895e+01,   9.51020634e+01,   1.01444171e+02,
         1.08245082e+02,   1.15540103e+02,   1.23367394e+02,
         1.31768217e+02,   1.40787193e+02,   1.50472589e+02,
         1.60876630e+02,   1.72055834e+02,   1.84071383e+02,
         1.96989521e+02,   2.10881992e+02,   2.25826515e+02,
         2.41907300e+02,   2.59215614e+02,   2.77850393e+02,
         2.97918916e+02,   3.19537533e+02,   3.42832461e+02,
         3.67940655e+02,   3.95010757e+02,   4.24204128e+02,
         4.55695977e+02])

par = [0.2,4000,1000]
dx = [-100,-50,-10,0,10,50,100]
fig = plt.figure(figsize=(5, 5))
sb = fig.add_subplot(111)
sb.tick_params(axis='both',which='both')
sb.set_xlabel("Voltage through LEM (V)")
sb.set_ylabel("Gain")
sb.set_yscale('log')
p, chisquare, result = toolbox.gainfit(Voltage, gain, par)
sb.plot(result[0], result[1], 'r-', linewidth = .5)
for x in dx:
  gain = [ gain_func(p,V,x) for V in Voltage]
  print(result[0][350],gain[349])
  sb.plot(result[0][1:], gain, label='${x}\mu m$'.format(x=x), linewidth = .5)
sb.legend(loc='best')
plt.show()
